<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dự đoán Churn Khách hàng - Chuyên nghiệp V2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* slate-100 */
            color: #334155; /* slate-700 */
        }
        label {
            @apply block text-xs font-semibold text-gray-500 mb-1 uppercase tracking-wider; /* Smaller, bolder labels */
        }
        /* Input styling */
        input[type="text"], input[type="number"], select {
            @apply mt-1 block w-full px-3 py-2.5 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm transition duration-200 ease-in-out hover:border-gray-400;
        }
        /* File input button styling */
        input[type="file"]::file-selector-button {
             @apply text-sm font-semibold bg-gradient-to-r from-indigo-50 to-purple-50 text-indigo-700 hover:from-indigo-100 hover:to-purple-100 px-4 py-2 border border-indigo-300 rounded-lg cursor-pointer transition duration-200 ease-in-out mr-4 shadow-sm;
        }
        /* Button styling with gradient and icon alignment */
        button {
            @apply inline-flex items-center justify-center py-2.5 px-6 border border-transparent shadow-lg text-sm font-medium rounded-lg text-white bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-60 disabled:cursor-not-allowed transition duration-200 ease-in-out transform hover:scale-105;
        }
        button i { @apply mr-2 -ml-1; } /* Align icon */

        /* Table styling */
        table {
            @apply min-w-full divide-y divide-gray-200 mt-4 border border-gray-200 rounded-lg shadow-md overflow-hidden; /* Added overflow hidden */
        }
        thead {
            @apply bg-gradient-to-r from-gray-50 to-gray-100; /* Subtle gradient header */
        }
        th {
            @apply px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider;
        }
        tbody tr:nth-child(even) { background-color: #f8fafc; } /* slate-50 for even rows */
        tbody tr:hover { background-color: #eef2ff; } /* indigo-50 on hover */
        td {
            @apply px-6 py-4 whitespace-nowrap text-sm text-gray-700 transition duration-150 ease-in-out;
        }
        /* Probability text styling */
        .probability-high { @apply text-red-600 font-bold; }
        .probability-medium { @apply text-amber-600 font-semibold; } /* Changed yellow to amber */
        .probability-low { @apply text-green-600 font-medium; }

        /* Loader styling */
        .loader {
            border: 4px solid #e5e7eb;
            border-top: 4px solid #6366f1; /* indigo-500 */
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: none;
            margin-left: 12px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Card styling with subtle gradient border on hover */
        .card {
            @apply bg-white p-6 md:p-8 rounded-xl shadow-lg mb-8 transition duration-300 ease-in-out border border-transparent hover:shadow-indigo-100 hover:border-indigo-200;
        }
        /* Result area styling */
        .result-area {
             @apply mt-6 p-5 rounded-lg border text-center transition-colors duration-300;
        }
        .result-area-default { @apply bg-gray-50 border-gray-200 text-gray-600; }
        .result-area-success { @apply bg-green-50 border-green-300 text-green-800; }
        .result-area-warning { @apply bg-yellow-50 border-yellow-300 text-yellow-800; }
        .result-area-danger { @apply bg-red-50 border-red-300 text-red-800; }

        /* Collapsible details styling */
        details summary {
             @apply list-none cursor-pointer text-indigo-600 hover:text-indigo-800 font-semibold mb-3 text-lg flex items-center;
             outline: none;
        }
         details summary::before { /* Custom arrow */
            content: '\25B6'; /* Right pointing triangle */
            margin-right: 0.5rem;
            font-size: 0.8em;
            transition: transform 0.2s ease-in-out;
            display: inline-block;
        }
        details[open] summary::before {
            transform: rotate(90deg); /* Down pointing triangle */
        }
        details > div {
             animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

    </style>
</head>
<body class="bg-slate-100 p-6 md:p-10">
    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-12">
             <svg class="mx-auto h-12 w-auto text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18 9 11.25l4.306 4.306a11.95 11.95 0 0 1 5.814-5.518l2.74-1.22m0 0-5.94-2.281m5.94 2.28-2.28 5.941" />
              </svg>
            <h1 class="text-3xl md:text-4xl font-extrabold text-slate-800 mt-4">Ứng dụng Dự đoán Churn Thông minh</h1>
            <p class="text-lg text-slate-500 mt-2 max-w-2xl mx-auto">Phân tích và dự đoán khả năng rời bỏ mạng của khách hàng bằng sức mạnh AI.</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">

            <div class="lg:col-span-3 space-y-8">
                <div class="card">
                    <h2 class="text-xl font-bold text-slate-700 mb-5 border-b border-slate-200 pb-3 flex items-center">
                         <i class="fas fa-user-pen mr-3 text-indigo-500 text-lg"></i>Dự đoán cho Khách hàng đơn lẻ
                    </h2>
                    <form id="churn-form" class="space-y-4">
                        <details open> <summary>Thông tin Chi tiết Khách hàng</summary>
                            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-x-5 gap-y-4 pt-4">
                                <div><label for="gender">Giới tính</label><select id="gender" name="gender" required><option value="Female">Nữ</option><option value="Male">Nam</option></select></div>
                                <div><label for="SeniorCitizen">Người cao tuổi (0/1)</label><select id="SeniorCitizen" name="SeniorCitizen" required><option value="0">0 - Không</option><option value="1">1 - Có</option></select></div>
                                <div><label for="Partner">Có người phối ngẫu</label><select id="Partner" name="Partner" required><option value="Yes">Có</option><option value="No">Không</option></select></div>
                                <div><label for="Dependents">Có người phụ thuộc</label><select id="Dependents" name="Dependents" required><option value="Yes">Có</option><option value="No">Không</option></select></div>
                                <div><label for="tenure">Thời gian sử dụng (tháng)</label><input type="number" id="tenure" name="tenure" min="0" required value="1"></div>
                                <div><label for="PhoneService">Dịch vụ Điện thoại</label><select id="PhoneService" name="PhoneService" required><option value="Yes">Có</option><option value="No">Không</option></select></div>
                                <div><label for="MultipleLines">Nhiều đường dây</label><select id="MultipleLines" name="MultipleLines" required><option value="No">Không</option><option value="Yes">Có</option><option value="No phone service">Không có DV ĐT</option></select></div>
                                <div><label for="InternetService">Dịch vụ Internet</label><select id="InternetService" name="InternetService" required><option value="DSL">DSL</option><option value="Fiber optic">Cáp quang</option><option value="No">Không</option></select></div>
                                <div><label for="OnlineSecurity">Bảo mật trực tuyến</label><select id="OnlineSecurity" name="OnlineSecurity" required><option value="No">Không</option><option value="Yes">Có</option><option value="No internet service">Không có DV Net</option></select></div>
                                <div><label for="OnlineBackup">Sao lưu trực tuyến</label><select id="OnlineBackup" name="OnlineBackup" required><option value="No">Không</option><option value="Yes">Có</option><option value="No internet service">Không có DV Net</option></select></div>
                                <div><label for="DeviceProtection">Bảo vệ thiết bị</label><select id="DeviceProtection" name="DeviceProtection" required><option value="No">Không</option><option value="Yes">Có</option><option value="No internet service">Không có DV Net</option></select></div>
                                <div><label for="TechSupport">Hỗ trợ kỹ thuật</label><select id="TechSupport" name="TechSupport" required><option value="No">Không</option><option value="Yes">Có</option><option value="No internet service">Không có DV Net</option></select></div>
                                <div><label for="StreamingTV">Streaming TV</label><select id="StreamingTV" name="StreamingTV" required><option value="No">Không</option><option value="Yes">Có</option><option value="No internet service">Không có DV Net</option></select></div>
                                <div><label for="StreamingMovies">Streaming Phim</label><select id="StreamingMovies" name="StreamingMovies" required><option value="No">Không</option><option value="Yes">Có</option><option value="No internet service">Không có DV Net</option></select></div>
                                <div><label for="Contract">Loại hợp đồng</label><select id="Contract" name="Contract" required><option value="Month-to-month">Theo tháng</option><option value="One year">Một năm</option><option value="Two year">Hai năm</option></select></div>
                                <div><label for="PaperlessBilling">Hóa đơn điện tử</label><select id="PaperlessBilling" name="PaperlessBilling" required><option value="Yes">Có</option><option value="No">Không</option></select></div>
                                <div><label for="PaymentMethod">Phương thức thanh toán</label><select id="PaymentMethod" name="PaymentMethod" required><option value="Electronic check">Séc điện tử</option><option value="Mailed check">Séc gửi thư</option><option value="Bank transfer (automatic)">Chuyển khoản NH (tự động)</option><option value="Credit card (automatic)">Thẻ tín dụng (tự động)</option></select></div>
                                <div><label for="MonthlyCharges">Phí hàng tháng</label><input type="number" id="MonthlyCharges" name="MonthlyCharges" step="0.01" min="0" required value="70.00"></div>
                                <div><label for="TotalCharges">Tổng phí</label><input type="text" id="TotalCharges" name="TotalCharges" value="150.00"></div>
                            </div>
                        </details>
                        <div class="flex items-center justify-center pt-5">
                            <button type="submit" id="submit-button-single">
                                <i class="fas fa-calculator"></i>Dự đoán Khách hàng này
                            </button>
                            <div id="loader-single" class="loader"></div>
                        </div>
                    </form>
                    <div id="result-area-single" class="result-area result-area-default">
                        <h3 class="text-base font-semibold text-slate-700 mb-1">Kết quả Dự đoán (Đơn lẻ)</h3>
                        <p id="prediction-output-single" class="text-xl font-bold text-slate-800">Chưa có dự đoán.</p>
                        <p id="error-message-single" class="text-red-600 mt-1 text-sm"></p>
                    </div>
                </div>

                <div class="card">
                    <h2 class="text-xl font-bold text-slate-700 mb-5 border-b border-slate-200 pb-3 flex items-center">
                         <i class="fas fa-file-upload mr-3 text-green-500 text-lg"></i>Dự đoán từ File CSV
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label for="csv-file">Chọn file CSV của bạn</label>
                            <input type="file" id="csv-file" name="csv-file" accept=".csv" required>
                            <p class="mt-1 text-xs text-gray-500">File cần có các cột tiêu đề: customerID, gender, tenure, Contract, MonthlyCharges...</p>
                        </div>
                        <div class="flex items-center justify-center pt-2">
                            <button type="button" id="submit-button-csv">
                                <i class="fas fa-sync-alt"></i>Xử lý File và Dự đoán
                            </button>
                            <div id="loader-csv" class="loader"></div>
                        </div>
                    </div>
                     <div id="result-area-csv" class="mt-6">
                        <h3 class="text-base font-semibold text-slate-700 mb-2">Kết quả Dự đoán (từ File)</h3>
                        <p id="error-message-csv" class="text-red-600 mt-1 text-sm mb-2"></p>
                        <div id="prediction-table-container" class="overflow-x-auto max-h-[30rem] rounded-lg border border-gray-200"> <p id="prediction-status-csv" class="text-gray-500 text-sm p-4 text-center">Chưa có dữ liệu từ file.</p>
                            </div>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-2 lg:sticky lg:top-10 h-fit"> <div class="card">
                     <h2 class="text-xl font-bold text-slate-700 mb-5 border-b border-slate-200 pb-3 flex items-center">
                         <i class="fas fa-lightbulb mr-3 text-yellow-500 text-lg"></i>Giải thích & Hành động
                    </h2>
                    <div class="space-y-4 text-sm text-slate-600 leading-relaxed">
                        <p>Mô hình AI phân tích các đặc điểm của khách hàng để đưa ra <span class="font-semibold text-indigo-600">Xác suất Churn</span> - khả năng họ sẽ rời bỏ dịch vụ.</p>
                        <div class="p-3 bg-indigo-50 rounded-lg border border-indigo-100">
                            <p class="font-semibold text-indigo-800 mb-1">Mức độ Rủi ro:</p>
                            <ul class="list-none space-y-1">
                                <li class="flex items-center"><span class="w-3 h-3 rounded-full bg-red-500 mr-2"></span><span class="probability-high">Cao (&ge; 70%):</span> Cần hành động ngay!</li>
                                <li class="flex items-center"><span class="w-3 h-3 rounded-full bg-yellow-500 mr-2"></span><span class="probability-medium">Trung bình (40% - 70%):</span> Cần quan tâm, theo dõi.</li>
                                <li class="flex items-center"><span class="w-3 h-3 rounded-full bg-green-500 mr-2"></span><span class="probability-low">Thấp (&lt; 40%):</span> Tương đối an toàn.</li>
                            </ul>
                        </div>
                        <p>Dựa vào xác suất này, bạn có thể:</p>
                        <ul class="list-disc list-inside space-y-1 pl-4">
                            <li><span class="font-semibold">Ưu tiên nguồn lực:</span> Tập trung vào nhóm khách hàng có rủi ro cao nhất.</li>
                            <li><span class="font-semibold">Cá nhân hóa ưu đãi:</span> Đưa ra các gói giữ chân phù hợp với từng mức độ rủi ro.</li>
                            <li><span class="font-semibold">Phân tích sâu hơn:</span> Tìm hiểu nguyên nhân gốc rễ của nhóm có nguy cơ cao.</li>
                        </ul>
                    </div>
                     <h3 class="text-lg font-semibold text-slate-700 mt-6 mb-3 border-b border-slate-200 pb-1">Lưu ý Quan trọng</h3>
                     <ul class="list-disc list-inside space-y-1 text-xs text-slate-500 pl-4">
                         <li>API Backend phải đang chạy để dự đoán.</li>
                         <li>Kết quả là dự đoán, không phải chắc chắn 100%.</li>
                         <li>Đảm bảo file CSV upload đúng định dạng.</li>
                     </ul>
                </div>
            </div>

        </div> <footer class="text-center mt-16 text-xs text-gray-400">
            <p>Churn Prediction Project</p>
            <p>Developed with FastAPI, Scikit-learn, MLflow & Tailwind CSS</p>
        </footer>
    </div> <script>
        // --- JavaScript Logic (Giữ nguyên như trước, chỉ cập nhật class CSS cho kết quả) ---
        const formSingle = document.getElementById('churn-form');
        const outputSingle = document.getElementById('prediction-output-single');
        const errorSingle = document.getElementById('error-message-single');
        const submitButtonSingle = document.getElementById('submit-button-single');
        const loaderSingle = document.getElementById('loader-single');
        const resultAreaSingle = document.getElementById('result-area-single');

        const fileInput = document.getElementById('csv-file');
        const submitButtonCsv = document.getElementById('submit-button-csv');
        const loaderCsv = document.getElementById('loader-csv');
        const errorCsv = document.getElementById('error-message-csv');
        const tableContainer = document.getElementById('prediction-table-container');
        const statusCsv = document.getElementById('prediction-status-csv');

        const apiUrl = 'http://127.0.0.1:8000/predict'; // API endpoint

        // --- Xử lý Form đơn lẻ ---
        formSingle.addEventListener('submit', async (event) => {
            event.preventDefault();
            loaderSingle.style.display = 'inline-block';
            submitButtonSingle.disabled = true;
            outputSingle.textContent = 'Đang phân tích...';
            errorSingle.textContent = '';
            resultAreaSingle.className = 'result-area result-area-default'; // Reset style

            const formData = new FormData(formSingle);
            const customerData = {};
            formData.forEach((value, key) => {
                if (key === 'SeniorCitizen' || key === 'tenure') customerData[key] = parseInt(value, 10);
                else if (key === 'MonthlyCharges') customerData[key] = parseFloat(value);
                else if (key === 'TotalCharges') customerData[key] = value.trim() === '' ? '' : value.trim();
                else customerData[key] = value;
            });

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST', headers: {'Content-Type': 'application/json', 'Accept': 'application/json'},
                    body: JSON.stringify(customerData)
                });
                if (response.ok) {
                    const result = await response.json();
                    const probability = result.ChurnProbability;
                    outputSingle.textContent = `Xác suất Churn: ${(probability * 100).toFixed(2)}%`;
                    if (probability >= 0.7) {
                        outputSingle.className = 'text-xl font-bold probability-high'; // Larger font for result
                        resultAreaSingle.className = 'result-area result-area-danger';
                    } else if (probability >= 0.4) {
                        outputSingle.className = 'text-xl font-bold probability-medium';
                         resultAreaSingle.className = 'result-area result-area-warning';
                    } else {
                        outputSingle.className = 'text-xl font-bold probability-low';
                         resultAreaSingle.className = 'result-area result-area-success';
                    }
                } else {
                    const errorData = await response.json();
                    errorSingle.textContent = `Lỗi API: ${errorData.detail || response.statusText}`;
                    outputSingle.textContent = 'Dự đoán thất bại.';
                    outputSingle.className = 'text-xl font-bold text-slate-800';
                    resultAreaSingle.className = 'result-area result-area-default';
                }
            } catch (error) {
                errorSingle.textContent = `Lỗi kết nối: ${error.message}. Đảm bảo API đang chạy.`;
                outputSingle.textContent = 'Dự đoán thất bại.';
                outputSingle.className = 'text-xl font-bold text-slate-800';
                resultAreaSingle.className = 'result-area result-area-default';
            } finally {
                loaderSingle.style.display = 'none';
                submitButtonSingle.disabled = false;
            }
        });

         // --- Xử lý Upload CSV ---
         submitButtonCsv.addEventListener('click', async () => {
            const file = fileInput.files[0];
            if (!file) {
                errorCsv.textContent = 'Vui lòng chọn một file CSV.';
                return;
            }
             if (file.type !== 'text/csv' && !file.name.toLowerCase().endsWith('.csv')) {
                 errorCsv.textContent = 'Định dạng file không hợp lệ. Vui lòng chọn file .csv.';
                 return;
            }

            loaderCsv.style.display = 'inline-block';
            submitButtonCsv.disabled = true;
            errorCsv.textContent = '';
            statusCsv.textContent = 'Đang đọc và xử lý file...';
            tableContainer.innerHTML = `<p id="prediction-status-csv" class="text-gray-500 text-sm p-4 text-center">Đang đọc và xử lý file...</p>`; // Clear previous table, show status

            const reader = new FileReader();

            reader.onload = async (event) => {
                const csvContent = event.target.result;
                try {
                    const customerList = parseCSV(csvContent);
                    if (!customerList || customerList.length === 0) {
                        throw new Error("Không thể phân tích cú pháp CSV hoặc file rỗng/không hợp lệ.");
                    }
                    // Update status inside the container
                     document.getElementById('prediction-status-csv').textContent = `Đã đọc ${customerList.length} khách hàng. Đang gửi đến API...`;


                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json', 'Accept': 'application/json'},
                        body: JSON.stringify(customerList)
                    });

                    if (response.ok) {
                        const results = await response.json();
                        // Clear status message before displaying table
                        tableContainer.innerHTML = '';
                        displayResultsInTable(customerList, results);
                    } else {
                        const errorData = await response.json();
                        throw new Error(`Lỗi API: ${errorData.detail || response.statusText}`);
                    }

                } catch (error) {
                    console.error('CSV Processing/API Error:', error);
                    errorCsv.textContent = `Lỗi: ${error.message}`;
                     tableContainer.innerHTML = `<p id="prediction-status-csv" class="text-red-600 text-sm p-4 text-center">Xử lý thất bại.</p>`;
                } finally {
                    loaderCsv.style.display = 'none';
                    submitButtonCsv.disabled = false;
                }
            };

            reader.onerror = () => {
                errorCsv.textContent = 'Lỗi khi đọc file.';
                loaderCsv.style.display = 'none';
                submitButtonCsv.disabled = false;
                 tableContainer.innerHTML = `<p id="prediction-status-csv" class="text-red-600 text-sm p-4 text-center">Lỗi đọc file.</p>`;
            };

            reader.readAsText(file, 'UTF-8'); // Specify encoding if possible
        });

        // --- Hàm Parse CSV (Giữ nguyên logic) ---
        function parseCSV(csvText) {
            const lines = csvText.trim().split(/\r?\n/);
            if (lines.length < 2) return [];
            const headers = lines[0].split(',').map(h => h.trim());
            const data = [];
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                if (values.length === headers.length) {
                    const customer = {};
                    let parseError = false;
                    for (let j = 0; j < headers.length; j++) {
                        const key = headers[j];
                        let value = values[j]?.trim() ?? ''; // Handle potential undefined values
                        if (value.startsWith('"') && value.endsWith('"')) {
                            value = value.substring(1, value.length - 1);
                        }
                        try {
                            if (key === 'SeniorCitizen' || key === 'tenure') {
                                customer[key] = parseInt(value, 10);
                                if (isNaN(customer[key])) throw new Error('Not a number');
                            } else if (key === 'MonthlyCharges') {
                                customer[key] = parseFloat(value);
                                if (isNaN(customer[key])) throw new Error('Not a number');
                            } else if (key === 'TotalCharges') {
                                if (value === '') { customer[key] = ''; }
                                else {
                                    const tc = parseFloat(value);
                                    if (isNaN(tc) && value.trim() !== '') throw new Error('Not a valid number or empty string');
                                    customer[key] = isNaN(tc) ? '' : tc;
                                }
                            } else { customer[key] = value; }
                        } catch (e) {
                            console.warn(`Lỗi parse cột '${key}' ở dòng ${i+1}: giá trị '${values[j]}'. Lỗi: ${e.message}`);
                            parseError = true; break;
                        }
                    }
                    if (!parseError) data.push(customer);
                    else console.warn(`Bỏ qua dòng ${i+1} do lỗi parse dữ liệu.`);
                } else { console.warn(`Bỏ qua dòng ${i+1} do số lượng cột (${values.length}) không khớp header (${headers.length}).`); }
            }
            return data;
        }

        // --- Hàm Hiển thị Bảng (Giữ nguyên logic, chỉ cập nhật class CSS) ---
         function displayResultsInTable(originalData, predictions) {
             if (!predictions || predictions.length === 0) {
                 tableContainer.innerHTML = '<p class="text-gray-500 text-sm p-4 text-center">Không có kết quả để hiển thị.</p>';
                 return;
             }
             // Added sticky header styling
             let tableHTML = `
                 <table class="min-w-full divide-y divide-gray-200 border border-gray-200 rounded-lg shadow-sm">
                     <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
                         <tr>
                             <th class="sticky top-0 bg-gradient-to-r from-gray-50 to-gray-100 px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider z-10">CustomerID</th>
                             <th class="sticky top-0 bg-gradient-to-r from-gray-50 to-gray-100 px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider z-10">Tenure</th>
                             <th class="sticky top-0 bg-gradient-to-r from-gray-50 to-gray-100 px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider z-10">Contract</th>
                             <th class="sticky top-0 bg-gradient-to-r from-gray-50 to-gray-100 px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider z-10">MonthlyCharges</th>
                             <th class="sticky top-0 bg-gradient-to-r from-gray-50 to-gray-100 px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider z-10">Xác suất Churn (%)</th>
                         </tr>
                     </thead>
                     <tbody class="bg-white divide-y divide-gray-200">
             `;
             predictions.forEach((pred, index) => {
                 const customer = originalData[index] || {};
                 const probability = pred.ChurnProbability;
                 let probClass = 'probability-low';
                 if (probability >= 0.7) probClass = 'probability-high';
                 else if (probability >= 0.4) probClass = 'probability-medium';
                 tableHTML += `
                     <tr class="hover:bg-indigo-50">
                         <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800">${customer.customerID || 'N/A'}</td>
                         <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800">${customer.tenure !== undefined ? customer.tenure : 'N/A'}</td>
                         <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800">${customer.Contract || 'N/A'}</td>
                         <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800">${customer.MonthlyCharges !== undefined ? customer.MonthlyCharges.toFixed(2) : 'N/A'}</td>
                         <td class="px-6 py-4 whitespace-nowrap text-sm ${probClass}">${(probability * 100).toFixed(2)}%</td>
                     </tr>
                 `;
             });
             tableHTML += `</tbody></table>`;
             tableContainer.innerHTML = tableHTML;
         }
    </script>
</body>
</html>
